version: "2.1"
description: "Simulate 'Only build pull requests' with git-flow"

orbs:
  only-build-pr-with-git-flow:
    jobs:
      check_enable_to_build:
        executor: simple-executor
        parameters:
          build_branches:
            description: "permit branches to build without pull requests. separate spaces"
            default: "master develop"
            type: string
        steps:
          - my_inline_command:
              build_branches: <<parameters.build_branches>>
    commands:
      my_inline_command:
        parameters:
          build_branch:
            type: string
        steps:
          - run: sh ./script/pr_existing_check.sh <<parameters.build_branches>>
    executors:
      simple_executor:
        parameters:
          version:
            type: string
            default: "2.4"
        docker:
          - image: circleci/ruby:<<parameters.version>>

workflows:
  only-build-pr-with-git-flow:
    jobs:
      - only-build-pr-with-git-flow:check_enable_to_build